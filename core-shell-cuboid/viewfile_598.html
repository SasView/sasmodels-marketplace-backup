
<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>View File | SasView Model Marketplace</title>
<link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" rel="stylesheet"/>
<link charset="utf-8" href="/static/marketplace/style.css" rel="stylesheet">
<link href="/static/marketplace/ball.ico" rel="shortcut icon" type="image/x-icon"/>
<script charset="utf-8" src="/static/marketplace/jquery-2.2.4.min.js"></script>
<script crossorigin="anonymous" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<link href="/static/marketplace/tomorrow-night.css" rel="stylesheet"/>
<script src="/static/marketplace/highlight.pack.js"></script>
<script type="text/javascript">
    hljs.initHighlightingOnLoad();
</script>
</link></head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
<div class="container container-fluid">
<div class="navbar-header">
<button aria-expanded="false" class="navbar-toggle collapsed" data-target="#navbar-collapse-1" data-toggle="collapse" type="button">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<img src="/static/marketplace/logo.png"/><a class="navbar-brand" href="/">SasView Marketplace</a>
</div>
<div class="collapse navbar-collapse" id="navbar-collapse-1">
<ul class="nav navbar-nav navbar-right">
<li><a href="/accounts/login/"><span class="glyphicon glyphicon-log-in"></span> Log In </a></li>
</ul>
<form action="/search/" class="navbar-form navbar-left" method="get">
<div class="form-group">
<input class="form-control" name="query" placeholder="Search" type="text"/>
</div>
<button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-search"></span></button>
</form>
</div><!-- /.navbar-collapse -->
</div>
</nav>
<div class="container">
<ol class="breadcrumb">
<li><a href="/">Categories</a></li>
<li><a href="/models/parallelepiped/">Parallelepiped</a></li>
<li><a href="/models/114/">Core shell cuboid</a></li>
<li><a href="/uploads/598">core_shell_cuboid.c</a></li>
</ol>
<h1>Core shell cuboid - core_shell_cuboid.c</h1>
<pre>
    <code>//  Author: 
//    Martin Schmiele
//    Niels-Bohr-Institutet
//    Koebenhavns Universitet
//    martin.schmiele@nbi.ku.dk
//
//  This program is free software: you can redistribute it and/or modify
//  it under the terms of the GNU General Public License as published by
//  the Free Software Foundation, either version 3 of the License, or
//  (at your option) any later version.
//
//  This program is distributed in the hope that it will be useful,
//  but WITHOUT ANY WARRANTY; without even the implied warranty of
//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//  GNU General Public License for more details.
//
//  You should have received a copy of the GNU General Public License
//  along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
//
//
//
//
//  Orientationally averaged form factor for a monodisperse core-shell cuboid.
//
//               ,p=.,,_                   
//             ,/l:]:::::77t==.,,_          
//          ,/5::::[::::::::::::::773==.,,_ 
//       ,/5:::::::{zps;;:::::::::::::::::ZL
//    ,/5::::::::;z$3EtttZZ5sws;;:::::::yEJ.
// ,/5:::::::::zEtt$3EtttttttttttZZQ@:yE::[ 
// J=775es;;;Z5tttt3EEtttttttttttt@E@/::::L 
//  L::::::@8N@@szj3EEtttttttttt@E3@E::::3L 
//  {::::::$ttttZ59Q@BgszjttttgE1ZZ3E::::{  
//  J::::::Jttttttt3EEZZ55B@@SE2K5t3L::::[  
//   L:::::JEttttt25E35Sz@zz$ttQttt$:::::L  
//   [::::::Ettt25EttttttttZV5U$szj$::::J.  
//   J::::::$t25Ettttttttttt$t31tt2Pwsz;]   
//    L:::::@5EtttttttttttttEt3[zZ:::::y`   
//    [:::/5?3Gszjtttttttttt$tJ@E:::::/     
//    J;z5:::::::775szjtttttEz@L:::::F      
//     *+z;::::::::::::73Gsg@EJ.:::yF       
//         `*+z;::::::::::::::{:::/`        
//              `*=z;:::::::::[::F          
//                   `*=c;::::[yF           
//                        `*=cE`            
//
double form_volume( double length, double thick_rim) ;
double Iq( double q, double core_sld, double rim_sld, double solvent_sld, double length, double thick_rim) ;
double Iqxy( double qx, double qy, double core_sld, double rim_sld, double solvent_sld, double length, double thick_rim, double theta, double phi, double psi) ;


double form_volume( double length, double thick_rim)
{
    // return length_a * length_b * length_c;
    return ( length + 2.0 * thick_rim ) * ( length + 2.0 * thick_rim ) * ( length + 2.0 * thick_rim ) ;
}


double Iq( double q, double core_sld, double rim_sld, double solvent_sld, double length, double thick_rim)
{
    const double l2 = 0.5 * length ;
    const double l2d = 0.5 * length + thick_rim ;

    const double muc = q * l2 ;
    const double mucs = q * l2d ;

    const double delta_rho_core_shell = core_sld - rim_sld ;
    const double delta_rho_shell_solvent = rim_sld - solvent_sld ;

    // outer integral for costhetaQ (with gauss points), integration limits = 0, 1
    double outer_total = 0; // initialize integral

    for( int i=0; i&lt;76; i++)
    {
        const double costhetaQ = 0.5 * ( Gauss76Z[i] + 1.0 ) ;
        const double sinthetaQ = sqrt( 1.0 - costhetaQ * costhetaQ ) ;
        const double muc_proj = muc * sinthetaQ ;
        const double mucs_proj = mucs * sinthetaQ ;

        const double sic3 = 2.0 * l2 * sas_sinx_x( muc * costhetaQ ) ;
        const double sics3 = 2.0 * l2d * sas_sinx_x( mucs * costhetaQ ) ;

        // inner integral for phiQ (with gauss points), integration limits = 0, 1
        double inner_total = 0.0 ;

        for( int j=0; j&lt;76; j++)
        {
            const double phiQ = M_PI_2 * 0.5 * ( Gauss76Z[j] + 1.0 ) ;
            double sinphiQ, cosphiQ ;
            SINCOS( phiQ, sinphiQ, cosphiQ) ;
            const double sic1 = 2.0 * l2 * sas_sinx_x( muc_proj * cosphiQ ) ;
            const double sic2 = 2.0 * l2 * sas_sinx_x( muc_proj * sinphiQ ) ;
            const double sics1 = 2.0 * l2d * sas_sinx_x( mucs_proj * cosphiQ ) ;
            const double sics2 = 2.0 * l2d * sas_sinx_x( mucs_proj * sinphiQ ) ;

            // last multiplicant could be pulled out
            const double f = delta_rho_core_shell * sic1 * sic2 * sic3 + delta_rho_shell_solvent * sics1 * sics2 * sics3 ;

            inner_total += Gauss76Wt[j] * f * f ;
        }
        // note that sum_{i=1}^{76} Gauss76Wt[i] * 1 = 2, thus normalize with 1/2
        inner_total *= 0.5;

        // now sum up the outer integral
        outer_total += Gauss76Wt[i] * inner_total ;
    }
    // note that sum_{i=1}^{76} Gauss76Wt[i] * 1 = 2, thus normalize with 1/2
    outer_total *= 0.5;

    // [ DeltaSLD^2/V V^2] = (10^-6 Ang^-2)^2 * Ang^3 = 10^-12 Ang^-1 = 10^-4 cm^-1
    // [ DeltaSLD^2 V^2] = (10^-6 Ang^-2)^2 * Ang^6 = 10^-12 Ang^2 = 10^4 cm^2
    return 1.0e-4 * outer_total ;

    // scaling with scale(volume fraction), background and normalization with whole particle volume done by sasview
    // provide form_volume() function for normalization, has been done in many other models (core-(multi)-shell sphere or vesicles, although not used in C-code there as well)
}


double Iqxy( double qx, double qy, double core_sld, double rim_sld, double solvent_sld, double length, double thick_rim, double theta, double phi, double psi)
{
    double q, cos_val_a, cos_val_b, cos_val_c ;
    ORIENT_ASYMMETRIC( qx, qy, theta, phi, psi, q, cos_val_c, cos_val_b, cos_val_a) ;

    const double l2 = 0.5 * length ;
    const double l2d = 0.5 * length + thick_rim ;

    const double muc = q * l2 ;
    const double mucs = q * l2d ;

    const double delta_rho_core_shell = core_sld - rim_sld ;
    const double delta_rho_shell_solvent = rim_sld - solvent_sld ;

    const double sic1 = 2.0 * l2 * sas_sinx_x( muc * cos_val_a ) ;
    const double sic2 = 2.0 * l2 * sas_sinx_x( muc * cos_val_b ) ;
    const double sic3 = 2.0 * l2 * sas_sinx_x( muc * cos_val_c ) ;
    const double sics1 = 2.0 * l2d * sas_sinx_x( mucs * cos_val_a ) ;
    const double sics2 = 2.0 * l2d * sas_sinx_x( mucs * cos_val_b ) ;
    const double sics3 = 2.0 * l2d * sas_sinx_x( mucs * cos_val_c ) ;

    const double f = delta_rho_core_shell * sic1 * sic2 * sic3 + delta_rho_shell_solvent * sics1 * sics2 * sics3 ;

    return 1.0e-4 * f * f ;
}
</code>
</pre>
<a class="btn btn-default" href="/models/114/">Back to Model</a>
<a class="btn btn-primary" href="/uploads/uploaded_models/core_shell_cuboid.c"><span class="glyphicon glyphicon-download"></span> Download</a>
</div>
</body>
</html>
